<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta id="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <script
      src="https://kit.fontawesome.com/24ae891478.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="css/utilities.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />

    <title>Abro Taxi</title>
  </head>

  <body id="home">
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
      integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <header class="hero contact">
      <div id="navbar" class="navbar top-contact">
        <h1 class="logo">
          <i class="fa-solid fa-taxi icon-taxi"></i> Abro
          <span class="text-primary"> Taxi</span>
        </h1>
        <nav>
          <ul>
            <li><a href="/">HOME</a></li>
            <li><a href="index.html#about">ABOUT</a></li>
            <li><a href="contact.html">CONTACT</a></li>
            <li><a href="/login">LOGIN</a></li>
            <li><a class="more" href="sidebar.html">MORE</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- Grid -->
    <main>
      <section class="section-registration">
        <form
          id="form-driver-register"
          method="post"
          action="/driverRegister"
          class="form-container"
        >
          <h1><span class="text-primary"> Driver </span> Registration</h1>

          <div class="input-container">
            <div id="input-box" class="input-box">
              <input id="first-name" placeholder="" type="text" required />
              <label>First Name</label>
            </div>
            <div id="input-box" class="input-box">
              <input id="middle-name" placeholder="" type="text" required />
              <label>Middle Name</label>
            </div>
            <div id="input-box" class="input-box">
              <input id="last-name" placeholder="" type="text" required />
              <label>Last Name</label>
            </div>
            <div id="input-box" class="input-box">
              <input id="driver-phone" placeholder="" type="tel" required />
              <label>Phone</label>
            </div>
            <div id="input-box" class="input-box">
              <input
                id="new-password"
                placeholder=""
                type="password"
                required
              />

              <label>Password</label>
            </div>
            <div id="input-box" class="input-box">
              <input
                id="confirm-password"
                placeholder=""
                type="text"
                required
              />
              <label>Confirm Password</label>
            </div>
            <div id="input-box" class="input-box">
              <input id="driver-email" placeholder="" type="email" required />
              <label>Email</label>
            </div>

            <div id="select-box" class="select-box">
              <select id="select-gender" class="auto-label" required="">
                <option></option>
                <option>Male</option>
                <option>Female</option>
              </select>
              <label>Gender</label>
            </div>
            <div id="select-box" class="select-box">
              <select id="select-vehicle" class="auto-label" required="">
                <option></option>
                <option value="vitz">vitz</option>
                <option value="Minibus">Minibus</option>
                <option value="executive">executive</option>
                <option value="MiniVAN">MiniVAN</option>
                <option value="Bus">Bus</option>
                <option value="Lada ">Lada</option>
              </select>
              <label>Vehicle</label>
            </div>

            <div id="select-box" class="select-box">
              <select id="select-model" class="auto-label" required="">
                <option></option>
                <option value="2010">2010</option>
                <option value="2011">2011</option>
                <option value="2012">2012</option>
                <option value="2013">2013</option>
                <option value="2014">2014</option>
                <option value="2015">2015</option>
                <option value="2016">2016</option>
                <option value="2017">2017</option>
                <option value="2018">2018</option>
                <option value="2019">2019</option>
                <option value="2020">2020</option>
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
              </select>
              <label>Model</label>
            </div>

            <div id="input-box" class="input-box">
              <input
                id="seats"
                placeholder=""
                type="number"
                onkeypress="validate(event)"
                required
              />
              <label>Available Seats</label>
            </div>
            <div id="input-box" class="input-box">
              <input id="plate" placeholder="" type="text" required />
              <label>Plate Number</label>
            </div>
            <div id="input-box" class="input-box">
              <button class="btn">Submit</button>
            </div>
          </div>
        </form>
      </section>
    </main>
    <script>
      const modal = document.getElementById('my-modal');
      const successMessage = document.getElementById('success-message');

      const input = document.querySelector('#driver-phone');
      const formContainer = document.querySelector('.form-container');
      const driverForm = document.querySelector('#form-driver-register');
      const driverEmail = document.querySelector('#driver-email');
      // Listen to change
      formContainer.addEventListener('change', function (e) {
        element = e.target;
        if (element.classList.contains('auto-label')) {
          if (element.value.trim() !== '') element.classList.add('changed');
          else element.classList.remove('changed');
        }
      });

      function showPass(element, type) {
        if (element.type === 'password' && type === 'focus') {
          element.type = 'text';
        } else {
          element.type = 'password';
        }
      }

      driverForm.addEventListener('focusin', function (e) {
        const element = e.target;
        if (
          element.getAttribute('id') === 'new-password' ||
          element.getAttribute('id') === 'confirm-password'
        ) {
          showPass(element, 'focus');
        }
      });

      driverForm.addEventListener('focusout', function (e) {
        const element = e.target;
        if (
          element.getAttribute('id') === 'new-password' ||
          element.getAttribute('id') === 'confirm-password'
        ) {
          showPass(element, 'blur');
        }

        if (driverEmail.value.trim()) {
          const emailRegex = /\S+@\S+\.\S+/;
          if (!emailRegex.test(driverEmail.value.trim())) {
            driverEmail.value = '';
          }
        }
      });

      function phoneNumber(inputTxt) {
        const phoneNo = /^\+?([0-9]{2})\)?[-. ]?([0-9]{4})[-. ]?([0-9]{4})$/;
        if (inputTxt.charAt(0) == '0' && inputTxt.charAt(1) == '9') {
          if (inputTxt.match(phoneNo)) {
            return true;
          } else return false;
        } else {
          return false;
        }
      }

      function validate(evt) {
        const theEvent = evt || window.event;
        let key = theEvent.keyCode || theEvent.which;
        key = String.fromCharCode(key);
        const regex = /[0-9]|\./;
        if (!regex.test(key)) {
          theEvent.returnValue = false;
          if (theEvent.preventDefault) {
            theEvent.preventDefault();
          }
        }
      }

      $(document).ready(function () {
        function setCharAt(str, index, chr) {
          if (index > str.length - 1) return str;
          return str.substring(0, index) + chr + str.substring(index + 1);
        }

        $('#form-driver-register').submit(function (e) {
          e.preventDefault(); // avoid to execute the actual submit of the form.

          const num = $('#driver-phone').val().trim();
          const fullNum = setCharAt(num, 0, '+251');

          if (phoneNumber(num)) {
            const data = {};

            data.firstName = $('[id=first-name]').val();
            data.middleName = $('[id=middle-name]').val();
            data.lastName = $('[id=last-name]').val();
            data.phone = fullNum;
            data.password = $('[id=new-password]').val();
            data.confirmPassword = $('[id=confirm-password]').val();
            data.email = $('[id=driver-email]').val();
            data.gender = $('[id=select-gender]').val();
            data.vehicle = $('[id=select-vehicle]').val();
            data.model = $('[id=select-model]').val();
            data.seats = $('[id=seats]').val();
            data.plate = $('[id=plate]').val();

            console.log(data);

            const form = $(this);
            const url = form.attr('action');

            $.ajax({
              type: 'POST',
              url: url,
              // data: form.serialize(),
              data: data,
              success: function (data) {
                apiResponse(data);
              },
            });
          } else {
            msg = {
              states: 'invalid-value',
              msg: 'please enter valid 10 digit phone number like 09xxxxxxxx',
              data: '',
            };
            apiResponse(msg);
          }
        });
      });

      function apiResponse(res) {
        if (res.states)
          Toastify({
            text: res.msg,
            duration: 3000,
            // destination: "https://github.com/apvarun/toastify-js",
            newWindow: true,
            close: true,
            gravity: 'top', // `top` or `bottom`
            position: 'right', // `left`, `center` or `right`
            stopOnFocus: false, // Prevents dismissing of toast on hover
            style: {
              background: 'linear-gradient(to right, #28a745, #28a745)',
            },
            onClick: function () {}, // Callback after click
          }).showToast();
      }

      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      };
    </script>
  </body>
</html>
